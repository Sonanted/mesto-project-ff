(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"73e89214-0c23-43f4-86c2-2071a55d95ef","Content-Type":"application/json"}};function t(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o={method:n,headers:e.headers};return r&&(o.body=r),fetch("".concat(e.baseUrl,"/").concat(t),o).then((function(e){return e.ok?e.json():Promise.reject("".concat(e.status," ").concat(e.url))})).then((function(e){return Promise.resolve(e)})).catch((function(e){return console.error(e)}))}var n="card",r="card__like-button_is-active",o="card__like-count",c="card__delete-button",a=document.querySelector("#card-template").content;function i(e,t,i,u,l){var s=a.querySelector(".".concat(n)).cloneNode(!0),d=s.querySelector(".".concat("card__image")),p=s.querySelector(".".concat("card__like-button"));return s.dataId=e._id,s.querySelector(".".concat("card__title")).textContent=e.name,d.src=e.link,d.alt=e.name,s.querySelector(".".concat(c)).addEventListener("click",i),p.addEventListener("click",u),e.likes.find((function(e){return e._id==t}))&&p.classList.add(r),d.addEventListener("click",(function(){return l(e.name,e.link)})),s.querySelector(".".concat(o)).textContent=e.likes.length,t!==e.owner._id&&s.querySelector(".".concat(c)).classList.add("card__delete-button_is-hidden"),s}var u="popup_is-opened";function l(e){"Escape"===e.key&&p(document.querySelector(".".concat(u)))}function s(e){e.classList.add(u),document.addEventListener("keydown",l)}function d(e){e.target.classList.contains("popup")&&p(e.target)}function p(e){e.classList.remove(u),document.removeEventListener("keydown",l)}function f(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button-inactive"):t.classList.add("popup__button-inactive")}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var v,y=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__image"),h=document.querySelectorAll(".popup__close"),E=document.querySelectorAll(".popup"),b=document.querySelector(".popup_type_image"),L=b.querySelector(".popup__image"),g=b.querySelector(".popup__caption"),k=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_avatar"),x=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),w=document.forms["edit-profile"],I=w.elements.name,P=w.elements.description,D=document.forms["new-place"],j=D.elements["place-name"],O=D.elements.link,N=document.forms["edit-avatar"],U=N.elements.avatar,J=[function(e){var r=e.target.closest(".".concat(n));!function(e){t("cards/".concat(e),"DELETE")}(r.dataId),r.remove()},function(e){var c=e.target.closest(".".concat(n));(e.target.classList.toggle(r)?function(e){return t("cards/likes/".concat(e),"PUT")}(c.dataId):function(e){return t("cards/likes/".concat(e),"DELETE")}(c.dataId)).then((function(e){c.querySelector(".".concat(o)).textContent=e.likes.length}))},function(e,t){L.src=t,L.alt=e,g.textContent=e,s(b)}];function M(e,t){var n=e.querySelector(".popup__button");n.textContent=t?"Сохранение...":"Сохранить",n.disabled=t,t||p(e.closest(".popup"))}function G(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,H(e.avatar),v=e._id}function H(e){document.querySelector(".profile__image").style="background-image: url('".concat(e,"')")}h.forEach((function(e){e.addEventListener("click",(function(){return p(e.closest(".popup"))}))})),E.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",d)})),_.addEventListener("click",(function(){I.value=x.textContent,P.value=T.textContent,s(k)})),S.addEventListener("click",(function(){return s(C)})),q.addEventListener("click",(function(){return s(A)})),w.addEventListener("submit",(function(e){return function(e){var n;e.preventDefault(),M(w,!0),(n=JSON.stringify({name:I.value,about:P.value}),t("users/me","PATCH",n)).then((function(e){G(e)})).finally((function(){return M(w,!1)}))}(e)})),D.addEventListener("submit",(function(e){return function(e){var n;e.preventDefault(),M(D,!0),(n=JSON.stringify({name:j.value,link:O.value}),t("cards","POST",n)).then((function(e){y.prepend(i.apply(void 0,[e,v].concat(J)))})).finally((function(){M(D,!1),D.reset()}))}(e)})),N.addEventListener("submit",(function(e){return function(e){var n;e.preventDefault(),M(N,!0),(n=JSON.stringify({avatar:U.value}),t("users/me/avatar","PATCH",n)).then((function(e){H(e.avatar)})).finally((function(){M(N,!1),N.reset()}))}(e)})),Promise.all([t("users/me","GET"),t("cards","GET")]).then((function(e){var t,n=function(e){if(Array.isArray(e))return m(e)}(t=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=n[0],o=n[1];Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");f(t,n),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity("Поле может содержать только латинские, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input-type-error"),n.textContent=""}(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input-type-error"),r.textContent=n}(e,t,t.validationMessage)}(e,r),f(t,n)}))}))}(e)})),G(r),o.forEach((function(e){return y.append(i.apply(void 0,[e,v].concat(J)))}))}))})();